!function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t){e.exports=require("express")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(t.asyncMiddleware=function(e){return function(t,r,s){Promise.resolve(e(t,r,s)).catch(function(e){e&&401===e.statusCode&&n(t),s()})}},t.cleanSession=function(e){e.path.includes("redmine")&&(e.session.redmine_auth=null),e.path.includes("gitlab-external")&&(e.session.gitlab_token=null),e.path.includes("github")&&(e.session.github_auth=null)});t.genuuid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var s=r(0),o=n(s),a=r(3),u=n(a),i=r(4),c=n(i),p=r(5),d=n(p),f=r(6),l=n(f),m=r(1),v=(0,o.default)();v.use(c.default.json()),v.use((0,u.default)({genid:function(){return(0,m.genuuid)()},resave:!0,saveUninitialized:!0,secret:"the secret",cookie:{secure:!1}})),v.set("trust proxy",1),v.use(o.default.static(d.default.join(__dirname,"./client"))),v.use("/api",l.default),v.listen(process.env.PORT||8081)},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(s,o){try{var a=t[s](o),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0}),r(7);var o=r(0),a=n(o),u=r(8),i=n(u),c=r(1),p={GITHUB:"https://api.github.com",GITLAB_EXTERNAL:"https://gitlab.catalyst.net.nz",REDMINE:"https://redmine.catalyst.net.nz"},d=a.default.Router();d.route("/projects/github").post((0,c.asyncMiddleware)(function(){var e=s(regeneratorRuntime.mark(function e(t,r,n){var s,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=new Buffer(t.body.username+":"+t.body.password).toString("base64"),o={Authorization:"Basic "+s,"User-Agent":"smv"},e.next=5,(0,i.default)({uri:p.GITHUB+"/user/repos",headers:o,json:!0});case 5:a=e.sent,r.setHeader("content-type","application/json"),r.json(a.map(function(e){return{id:e.full_name,name:e.name}})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),r.json(e.t0);case 13:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(t,r,n){return e.apply(this,arguments)}}())),d.route("/projects/gitlab-external").post((0,c.asyncMiddleware)(function(){var e=s(regeneratorRuntime.mark(function e(t,r,n){var s,o,a,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Buffer(t.body.username+":"+t.body.password).toString("base64"),o={Authorization:"Basic "+s},e.next=4,(0,i.default)({method:"POST",uri:p.GITLAB_EXTERNAL+"/oauth/token",formData:{username:t.body.username,password:t.body.password,grant_type:"password"}});case 4:return a=e.sent,u=""+JSON.parse(a).access_token,e.next=8,(0,i.default)({uri:p.GITLAB_EXTERNAL+"/api/v4/projects?access_token="+u,json:!0});case 8:c=e.sent,r.setHeader("content-type","application/json"),r.json(c);case 11:case"end":return e.stop()}},e,void 0)}));return function(t,r,n){return e.apply(this,arguments)}}())),d.route("/projects/redmine").post((0,c.asyncMiddleware)(function(){var e=s(regeneratorRuntime.mark(function e(t,r,n){var s,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Buffer(t.body.username+":"+t.body.password).toString("base64"),o={Authorization:"Basic "+s},e.next=4,(0,i.default)({uri:p.REDMINE+"/projects.json",headers:o,json:!0});case 4:a=e.sent,r.setHeader("content-type","application/json"),r.json(a.projects.map(function(e){return{id:e.id,name:e.name}}));case 7:case"end":return e.stop()}},e,void 0)}));return function(t,r,n){return e.apply(this,arguments)}}())),d.route("/fetch-view-data/github").post((0,c.asyncMiddleware)(function(){var e=s(regeneratorRuntime.mark(function e(t,r,n){var s,o,a,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=new Buffer(t.body.username+":"+t.body.password).toString("base64"),o={Authorization:"Basic "+s,"User-Agent":"smv"},a=[p.GITHUB+"/repos/"+t.body.project+"/issues",p.GITHUB+"/repos/"+t.body.project+"/labels",p.GITHUB+"/repos/"+t.body.project+"/milestones"],u=a.map(function(e){return(0,i.default)({uri:e,headers:o,json:!0})}),e.next=7,Promise.all(u);case 7:c=e.sent,r.json(c),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),r.status(400).send(e.t0);case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t,r,n){return e.apply(this,arguments)}}())),d.route("/fetch-view-data/gitlab-external").post((0,c.asyncMiddleware)(function(){var e=s(regeneratorRuntime.mark(function e(t,r,n){var s,o,a,u,c,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=new Buffer(t.body.username+":"+t.body.password).toString("base64"),o={Authorization:"Basic "+s},e.next=5,(0,i.default)({method:"POST",uri:p.GITLAB_EXTERNAL+"/oauth/token",formData:{username:t.body.username,password:t.body.password,grant_type:"password"}});case 5:return a=e.sent,u=""+JSON.parse(a).access_token,c=[p.GITLAB_EXTERNAL+"/api/v4/projects/"+t.body.project+"/issues?access_token="+u,p.GITLAB_EXTERNAL+"/api/v4/projects/"+t.body.project+"/labels?access_token="+u,p.GITLAB_EXTERNAL+"/api/v4/projects/"+t.body.project+"/milestones?access_token="+u],d=c.map(function(e){return(0,i.default)({uri:e,json:!0})}),e.next=11,Promise.all(d);case 11:f=e.sent,r.json(f),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),r.status(400).send(e.t0);case 18:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(t,r,n){return e.apply(this,arguments)}}())),d.route("/fetch-view-data/redmine").post((0,c.asyncMiddleware)(function(){var e=s(regeneratorRuntime.mark(function e(t,r,n){var s,o,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=new Buffer(t.body.username+":"+t.body.password).toString("base64"),o={Authorization:"Basic "+s},a=[p.REDMINE+"/issues.json?project_id="+t.body.project+"&limit=100",p.REDMINE+"/projects/"+t.body.project+".json?include=issue_categories"],u=a.map(function(e){return(0,i.default)({uri:e,headers:o,json:!0})}),e.t0=r,e.next=8,Promise.all(u);case 8:e.t1=e.sent,e.t0.json.call(e.t0,e.t1),e.next=15;break;case 12:e.prev=12,e.t2=e.catch(0),r.status(403).send(e.t2);case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t,r,n){return e.apply(this,arguments)}}()));t.default=d},function(e,t){e.exports=require("babel-polyfill")},function(e,t){e.exports=require("request-promise")}]);